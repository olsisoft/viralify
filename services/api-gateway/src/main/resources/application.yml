server:
  port: 8080

spring:
  application:
    name: api-gateway
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:docker}
  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:3000"
              - "https://viraltok.app"
              - "https://olsitec.com"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders:
              - "*"
            allowCredentials: true
      routes:
        # Auth Service Routes
        - id: auth-service
          uri: ${AUTH_SERVICE_URL:http://auth-service:8081}
          predicates:
            - Path=/api/v1/auth/**
        # Content Generator Routes
        - id: content-service
          uri: ${CONTENT_SERVICE_URL:http://content-generator:8001}
          predicates:
            - Path=/api/v1/content/**
          filters:
            - RewritePath=/api/v1/content/(?<segment>.*), /api/v1/${segment}
        - id: content-service-direct
          uri: ${CONTENT_SERVICE_URL:http://content-generator:8001}
          predicates:
            - Path=/api/v1/generate/**
        # Trend Analyzer Routes
        - id: trend-service
          uri: ${TREND_SERVICE_URL:http://trend-analyzer:8000}
          predicates:
            - Path=/api/v1/trends/**
        # Scheduler Service Routes
        - id: scheduler-service
          uri: ${SCHEDULER_SERVICE_URL:http://scheduler-service:8082}
          predicates:
            - Path=/api/v1/scheduler/**, /api/v1/posts/**
        # Analytics Service Routes
        - id: analytics-service
          uri: ${ANALYTICS_SERVICE_URL:http://analytics-service:8002}
          predicates:
            - Path=/api/v1/analytics/**
        # Media Generator Routes
        - id: media-service
          uri: ${MEDIA_SERVICE_URL:http://media-generator:8004}
          predicates:
            - Path=/api/v1/media/**
        # Coaching Service Routes
        - id: coaching-service
          uri: ${COACHING_SERVICE_URL:http://coaching-service:8005}
          predicates:
            - Path=/api/v1/coaching/**

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,gateway
  endpoint:
    gateway:
      enabled: true

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    reactor.netty: INFO

---
spring:
  config:
    activate:
      on-profile: docker
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: 6379
      password: ${REDIS_PASSWORD:redis_secure_2024}
  cloud:
    gateway:
      routes:
        # Auth Service Routes
        - id: auth-service
          uri: http://auth-service:8081
          predicates:
            - Path=/api/v1/auth/**
        # Content Generator Routes
        - id: content-service
          uri: http://content-generator:8001
          predicates:
            - Path=/api/v1/content/**
          filters:
            - RewritePath=/api/v1/content/(?<segment>.*), /api/v1/${segment}
        - id: content-service-direct
          uri: http://content-generator:8001
          predicates:
            - Path=/api/v1/generate/**
        # Trend Analyzer Routes
        - id: trend-service
          uri: http://trend-analyzer:8000
          predicates:
            - Path=/api/v1/trends/**
        # Scheduler Service Routes
        - id: scheduler-service
          uri: http://scheduler-service:8082
          predicates:
            - Path=/api/v1/scheduler/**
        - id: posts-service
          uri: http://scheduler-service:8082
          predicates:
            - Path=/api/v1/posts/**
        # Analytics Service Routes
        - id: analytics-service
          uri: http://analytics-service:8002
          predicates:
            - Path=/api/v1/analytics/**
        # Media Generator Routes
        - id: media-service
          uri: http://media-generator:8004
          predicates:
            - Path=/api/v1/media/**
        # Coaching Service Routes
        - id: coaching-service
          uri: http://coaching-service:8005
          predicates:
            - Path=/api/v1/coaching/**
        # Presentation Generator Routes
        - id: presentation-service
          uri: http://presentation-generator:8006
          predicates:
            - Path=/api/v1/presentations/**
        # Course Generator Routes
        - id: course-service
          uri: http://course-generator:8007
          predicates:
            - Path=/api/v1/courses/**
        # Source Library Routes (course-generator)
        - id: source-service
          uri: http://course-generator:8007
          predicates:
            - Path=/api/v1/sources/**
        # Document Upload Routes (course-generator RAG)
        - id: document-service
          uri: http://course-generator:8007
          predicates:
            - Path=/api/v1/documents/**

---
# Local Development Profile
spring:
  config:
    activate:
      on-profile: local
  data:
    redis:
      host: localhost
      port: 6379
      password: redis_secure_2024
  cloud:
    gateway:
      routes:
        # Auth Service Routes
        - id: auth-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/v1/auth/**
        # Content Generator Routes
        - id: content-service
          uri: http://localhost:8001
          predicates:
            - Path=/api/v1/content/**
          filters:
            - RewritePath=/api/v1/content/(?<segment>.*), /api/v1/${segment}
        - id: content-service-direct
          uri: http://localhost:8001
          predicates:
            - Path=/api/v1/generate/**
        # Trend Analyzer Routes
        - id: trend-service
          uri: http://localhost:8000
          predicates:
            - Path=/api/v1/trends/**
        # Scheduler Service Routes
        - id: scheduler-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/v1/scheduler/**
        - id: posts-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/v1/posts/**
        # Analytics Service Routes
        - id: analytics-service
          uri: http://localhost:8002
          predicates:
            - Path=/api/v1/analytics/**
        # Media Generator Routes
        - id: media-service
          uri: http://localhost:8004
          predicates:
            - Path=/api/v1/media/**
        # Coaching Service Routes
        - id: coaching-service
          uri: http://localhost:8005
          predicates:
            - Path=/api/v1/coaching/**
        # Presentation Generator Routes
        - id: presentation-service
          uri: http://localhost:8006
          predicates:
            - Path=/api/v1/presentations/**
        # Course Generator Routes
        - id: course-service
          uri: http://localhost:8007
          predicates:
            - Path=/api/v1/courses/**
        # Source Library Routes (course-generator)
        - id: source-service
          uri: http://localhost:8007
          predicates:
            - Path=/api/v1/sources/**
        # Document Upload Routes (course-generator RAG)
        - id: document-service
          uri: http://localhost:8007
          predicates:
            - Path=/api/v1/documents/**

---
# Hybrid Profile: Java in Docker, Python on host
spring:
  config:
    activate:
      on-profile: hybrid
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: 6379
      password: ${REDIS_PASSWORD:redis_secure_2024}
  cloud:
    gateway:
      routes:
        # Auth Service (Docker network)
        - id: auth-service
          uri: http://auth-service:8081
          predicates:
            - Path=/api/v1/auth/**
        # Python services (host machine via host.docker.internal)
        - id: content-service
          uri: http://host.docker.internal:8001
          predicates:
            - Path=/api/v1/content/**
          filters:
            - RewritePath=/api/v1/content/(?<segment>.*), /api/v1/${segment}
        - id: content-service-direct
          uri: http://host.docker.internal:8001
          predicates:
            - Path=/api/v1/generate/**
        - id: trend-service
          uri: http://host.docker.internal:8000
          predicates:
            - Path=/api/v1/trends/**
        - id: analytics-service
          uri: http://host.docker.internal:8002
          predicates:
            - Path=/api/v1/analytics/**
        - id: media-service
          uri: http://host.docker.internal:8004
          predicates:
            - Path=/api/v1/media/**
        - id: coaching-service
          uri: http://host.docker.internal:8005
          predicates:
            - Path=/api/v1/coaching/**
        - id: presentation-service
          uri: http://host.docker.internal:8006
          predicates:
            - Path=/api/v1/presentations/**
        - id: course-service
          uri: http://host.docker.internal:8007
          predicates:
            - Path=/api/v1/courses/**
        - id: source-service
          uri: http://host.docker.internal:8007
          predicates:
            - Path=/api/v1/sources/**
        - id: document-service
          uri: http://host.docker.internal:8007
          predicates:
            - Path=/api/v1/documents/**
